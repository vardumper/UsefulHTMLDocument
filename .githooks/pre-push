#!/usr/bin/env php
<?php
exec('git rev-parse --abbrev-ref HEAD', $branchNameOutput, $branchNameReturnCode);
if ($branchNameReturnCode !== 0) {
    echo "Failed to get the current branch name." . PHP_EOL;
    exit(1);
}
$currentBranch = trim(implode(PHP_EOL, $branchNameOutput));

echo "Running tests on branch: $currentBranch" . PHP_EOL;
exec('./vendor/bin/phpunit --colors=always', $output, $returnCode);
if ($returnCode != 0) {
    foreach($output as $line) {
        if (strpos($line, 'FAILURES!') !== false) {
            print("Failed.");
            exit(1);
        }
    }
    print("Passed.");
    exit(0);
    // printf("Fuck! Something went wrong: %s (%s)", join(PHP_EOL, $output), $code);
}

print("Passed.");
exit(0);